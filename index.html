<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Site Report System</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f8fafc;
            line-height: 1.5;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: white;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 22px;
            margin-bottom: 8px;
        }
        
        .header-info {
            font-size: 13px;
            opacity: 0.9;
        }
        
        /* Status Bar */
        .status-bar {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-left {
            flex: 1;
        }
        
        .status-right {
            text-align: right;
            font-size: 12px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: white;
            border-bottom: 2px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 100;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            min-width: 100px;
            padding: 14px 8px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            background: white;
            color: #6b7280;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .tab.active {
            color: #1e40af;
            border-bottom-color: #1e40af;
            background: #eff6ff;
        }
        
        /* Content */
        .content {
            padding: 20px;
            padding-bottom: 120px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .card h3 {
            color: #1e40af;
            font-weight: 700;
            margin-bottom: 16px;
            font-size: 18px;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            transition: border-color 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
        
        .form-select {
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 48px;
        }
        
        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: #1e40af;
            color: white;
        }
        
        .btn-success {
            background: #059669;
            color: white;
        }
        
        .btn-warning {
            background: #d97706;
            color: white;
        }
        
        .btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Activity Entry */
        .activity-entry {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .activity-time {
            background: #1e40af;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .activity-delete {
            background: #dc2626;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .activity-details {
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Summary Stats */
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .summary-item {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #93c5fd;
        }
        
        .summary-number {
            font-size: 24px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 4px;
        }
        
        .summary-label {
            font-size: 12px;
            color: #1e40af;
            font-weight: 600;
        }
        
        /* Photo Section */
        .photo-section {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            text-align: center;
            background: #fafafa;
        }
        
        .photo-preview {
            width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .photo-name {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 2px solid #e5e7eb;
            padding: 16px 20px;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .bottom-nav .btn-group {
            max-width: 480px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        /* Utilities */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .success-message {
            background: #dcfce7;
            border: 1px solid #16a34a;
            color: #15803d;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            text-align: center;
            font-weight: 500;
        }
        
        .error-message {
            background: #fef2f2;
            border: 1px solid #ef4444;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            text-align: center;
            font-weight: 500;
        }

        .info-message {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            color: #1e40af;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            text-align: center;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä Daily Site Report System</h1>
            <div class="header-info">
                <span id="current-date"></span> ‚Ä¢ <span id="current-time"></span>
            </div>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-left">
                <div style="font-weight: 600;">üìÖ Today's Report</div>
                <div style="font-size: 12px; opacity: 0.9;"><span id="activity-count">0</span> activities recorded</div>
            </div>
            <div class="status-right">
                <div style="font-weight: 600;" id="report-status">üü° In Progress</div>
                <div>Last saved: <span id="last-saved">Not saved</span></div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview', this)">üìã Overview</button>
            <button class="tab" onclick="showTab('activity', this)">‚ûï Activity</button>
            <button class="tab" onclick="showTab('safety', this)">üõ°Ô∏è Safety</button>
            <button class="tab" onclick="showTab('summary', this)">üìä Summary</button>
            <button class="tab" onclick="showTab('settings', this)">‚öôÔ∏è Settings</button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Overview Tab -->
            <div id="overview-content" class="tab-content active">
                <!-- Site Information -->
                <div class="card">
                    <h3>üèóÔ∏è Site Information</h3>
                    <div class="form-group">
                        <label class="form-label">Project</label>
                        <select id="project-name" class="form-select">
                            <option value="">Select Project</option>
                            <option value="ABC Tower Construction">ABC Tower Construction</option>
                            <option value="Office Complex Phase 2">Office Complex Phase 2</option>
                            <option value="Shopping Mall Development">Shopping Mall Development</option>
                            <option value="Residential Block A">Residential Block A</option>
                            <option value="Industrial Warehouse">Industrial Warehouse</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Site Supervisor</label>
                            <select id="site-supervisor" class="form-select">
                                <option value="">Select Supervisor</option>
                                <option value="John Smith">John Smith</option>
                                <option value="Michael Chen">Michael Chen</option>
                                <option value="Sarah Johnson">Sarah Johnson</option>
                                <option value="David Lee">David Lee</option>
                                <option value="Maria Rodriguez">Maria Rodriguez</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Work Shift</label>
                            <select id="work-shift" class="form-select">
                                <option value="">Select Shift</option>
                                <option value="Day Shift (7AM-7PM)">Day Shift (7AM-7PM)</option>
                                <option value="Night Shift (7PM-7AM)">Night Shift (7PM-7AM)</option>
                                <option value="Morning (7AM-3PM)">Morning (7AM-3PM)</option>
                                <option value="Afternoon (3PM-11PM)">Afternoon (3PM-11PM)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Weather & Site Conditions -->
                <div class="card">
                    <h3>üå§Ô∏è Weather & Site Conditions</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Weather</label>
                            <select id="weather-condition" class="form-select">
                                <option value="">Select Weather</option>
                                <option value="Sunny">‚òÄÔ∏è Sunny</option>
                                <option value="Partly Cloudy">‚õÖ Partly Cloudy</option>
                                <option value="Cloudy">‚òÅÔ∏è Cloudy</option>
                                <option value="Light Rain">üå¶Ô∏è Light Rain</option>
                                <option value="Heavy Rain">üåßÔ∏è Heavy Rain</option>
                                <option value="Windy">üí® Windy</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Temperature</label>
                            <select id="temperature" class="form-select">
                                <option value="">Select Temp</option>
                                <option value="Below 10¬∞C">Below 10¬∞C</option>
                                <option value="10-20¬∞C">10-20¬∞C</option>
                                <option value="20-30¬∞C">20-30¬∞C</option>
                                <option value="Above 30¬∞C">Above 30¬∞C</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Site Conditions</label>
                        <select id="site-conditions" class="form-select">
                            <option value="">Select Conditions</option>
                            <option value="Dry and Safe">Dry and Safe</option>
                            <option value="Wet Surfaces">Wet Surfaces</option>
                            <option value="Muddy Areas">Muddy Areas</option>
                            <option value="Slippery Conditions">Slippery Conditions</option>
                            <option value="Poor Visibility">Poor Visibility</option>
                        </select>
                    </div>
                </div>

                <!-- Today's Activities -->
                <div class="card">
                    <h3>üìù Today's Activities</h3>
                    <div id="activities-list">
                        <div class="text-center" style="padding: 40px; color: #6b7280;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                            <p>No activities recorded today.<br>Use the Activity tab to add work entries.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activity Tab -->
            <div id="activity-content" class="tab-content">
                <!-- Time Entry -->
                <div class="card">
                    <h3>‚è∞ Activity Time</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Start Time</label>
                            <input type="time" id="activity-start-time" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Time</label>
                            <input type="time" id="activity-end-time" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Location & Contractor -->
                <div class="card">
                    <h3>üìç Location & Contractor</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Building/Floor</label>
                            <select id="location" class="form-select">
                                <option value="">Select Location</option>
                                <option value="Ground Floor">Ground Floor</option>
                                <option value="1st Floor">1st Floor</option>
                                <option value="2nd Floor">2nd Floor</option>
                                <option value="3rd Floor">3rd Floor</option>
                                <option value="4th Floor">4th Floor</option>
                                <option value="5th Floor">5th Floor</option>
                                <option value="Basement 1">Basement 1</option>
                                <option value="Basement 2">Basement 2</option>
                                <option value="Rooftop">Rooftop</option>
                                <option value="External Area">External Area</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Specific Area</label>
                            <select id="specific-area" class="form-select">
                                <option value="">Select Area</option>
                                <option value="North Wing">North Wing</option>
                                <option value="South Wing">South Wing</option>
                                <option value="East Wing">East Wing</option>
                                <option value="West Wing">West Wing</option>
                                <option value="Central Core">Central Core</option>
                                <option value="Lobby Area">Lobby Area</option>
                                <option value="Service Area">Service Area</option>
                                <option value="Stairwell">Stairwell</option>
                                <option value="Elevator Shaft">Elevator Shaft</option>
                                <option value="Mechanical Room">Mechanical Room</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Room/Unit Details</label>
                        <input type="text" id="location-details" placeholder="e.g., Room 301, Unit A, Grid Line 5-8" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contractor</label>
                        <select id="contractor" class="form-select">
                            <option value="">Select Contractor</option>
                            <option value="ABC Construction Ltd">ABC Construction Ltd</option>
                            <option value="BuildPro Engineering">BuildPro Engineering</option>
                            <option value="Elite Contractors">Elite Contractors</option>
                            <option value="MegaBuild Corp">MegaBuild Corp</option>
                            <option value="Premier Construction">Premier Construction</option>
                            <option value="Skyline Builders">Skyline Builders</option>
                            <option value="TechBuild Solutions">TechBuild Solutions</option>
                            <option value="Urban Development Co">Urban Development Co</option>
                        </select>
                    </div>
                </div>

                <!-- Work Details -->
                <div class="card">
                    <h3>üîß Work Details</h3>
                    <div class="form-group">
                        <label class="form-label">Work Category</label>
                        <select id="work-category" class="form-select" onchange="updateWorkTypes()">
                            <option value="">Select Category</option>
                            <option value="Structural">Structural Work</option>
                            <option value="Mechanical">Mechanical Work</option>
                            <option value="Electrical">Electrical Work</option>
                            <option value="Plumbing">Plumbing Work</option>
                            <option value="HVAC">HVAC Work</option>
                            <option value="Fire Safety">Fire Safety</option>
                            <option value="Finishes">Finishes & Fixtures</option>
                            <option value="Landscaping">Landscaping</option>
                            <option value="Testing">Testing & Commissioning</option>
                            <option value="Maintenance">Maintenance</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Specific Work Type</label>
                        <select id="work-type" class="form-select">
                            <option value="">Select Work Type</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Work Description</label>
                        <textarea id="work-description" placeholder="Detailed description of work performed..." rows="3" class="form-textarea"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Work Status</label>
                            <select id="work-status" class="form-select">
                                <option value="">Select Status</option>
                                <option value="Started">Started</option>
                                <option value="In Progress">In Progress</option>
                                <option value="50% Complete">50% Complete</option>
                                <option value="75% Complete">75% Complete</option>
                                <option value="Completed">Completed</option>
                                <option value="On Hold">On Hold</option>
                                <option value="Delayed">Delayed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quality Status</label>
                            <select id="quality-status" class="form-select">
                                <option value="">Select Quality</option>
                                <option value="Excellent">Excellent</option>
                                <option value="Good">Good</option>
                                <option value="Satisfactory">Satisfactory</option>
                                <option value="Needs Improvement">Needs Improvement</option>
                                <option value="Failed Inspection">Failed Inspection</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Manpower -->
                <div class="card">
                    <h3>üë• Manpower</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Workers</label>
                            <select id="worker-count" class="form-select">
                                <option value="">Count</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="20">20+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Equipment Used</label>
                            <select id="equipment-used" class="form-select">
                                <option value="">Select Equipment</option>
                                <option value="Tower Crane">Tower Crane</option>
                                <option value="Mobile Crane">Mobile Crane</option>
                                <option value="Excavator">Excavator</option>
                                <option value="Concrete Mixer">Concrete Mixer</option>
                                <option value="Scaffold System">Scaffold System</option>
                                <option value="Working Platform">Working Platform</option>
                                <option value="Welding Equipment">Welding Equipment</option>
                                <option value="Hand Tools Only">Hand Tools Only</option>
                                <option value="Multiple Equipment">Multiple Equipment</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Photos -->
                <div class="card">
                    <h3>üì∏ Activity Photos</h3>
                    <div class="form-row">
                        <div class="photo-section">
                            <label class="form-label">Before Photo</label>
                            <div id="photo1-preview" class="hidden">
                                <img id="photo1-img" class="photo-preview">
                                <div class="photo-name" id="photo1-name"></div>
                                <button onclick="removePhoto(1)" class="btn" style="background: #dc2626; color: white; width: auto; padding: 8px 16px; font-size: 12px;">Remove</button>
                            </div>
                            <div id="photo1-input">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                                    <button onclick="capturePhoto(1)" class="btn btn-primary" style="padding: 12px; font-size: 14px;">üì∑ Camera</button>
                                    <button onclick="selectPhoto(1)" class="btn" style="background: #6b7280; color: white; padding: 12px; font-size: 14px;">üìÅ Gallery</button>
                                </div>
                                <input type="file" id="photo1-camera" accept="image/*" capture="environment" style="display: none;" onchange="handlePhoto(1, this)">
                                <input type="file" id="photo1-gallery" accept="image/*" style="display: none;" onchange="handlePhoto(1, this)">
                            </div>
                        </div>
                        
                        <div class="photo-section">
                            <label class="form-label">After Photo</label>
                            <div id="photo2-preview" class="hidden">
                                <img id="photo2-img" class="photo-preview">
                                <div class="photo-name" id="photo2-name"></div>
                                <button onclick="removePhoto(2)" class="btn" style="background: #dc2626; color: white; width: auto; padding: 8px 16px; font-size: 12px;">Remove</button>
                            </div>
                            <div id="photo2-input">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                                    <button onclick="capturePhoto(2)" class="btn btn-primary" style="padding: 12px; font-size: 14px;">üì∑ Camera</button>
                                    <button onclick="selectPhoto(2)" class="btn" style="background: #6b7280; color: white; padding: 12px; font-size: 14px;">üìÅ Gallery</button>
                                </div>
                                <input type="file" id="photo2-camera" accept="image/*" capture="environment" style="display: none;" onchange="handlePhoto(2, this)">
                                <input type="file" id="photo2-gallery" accept="image/*" style="display: none;" onchange="handlePhoto(2, this)">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Activity Button -->
                <button onclick="addActivity()" class="btn btn-success">‚ûï Add Activity</button>
                
                <div id="activity-message"></div>
            </div>

            <!-- Safety Tab -->
            <div id="safety-content" class="tab-content">
                <!-- Safety Status -->
                <div class="card">
                    <h3>üõ°Ô∏è Daily Safety Status</h3>
                    <div class="form-group">
                        <label class="form-label">Overall Safety Status</label>
                        <select id="safety-status" class="form-select">
                            <option value="">Select Status</option>
                            <option value="Excellent - No Issues">üü¢ Excellent - No Issues</option>
                            <option value="Good - Minor Issues">üü° Good - Minor Issues</option>
                            <option value="Fair - Some Concerns">üü† Fair - Some Concerns</option>
                            <option value="Poor - Major Issues">üî¥ Poor - Major Issues</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Safety Officer Present</label>
                            <select id="safety-officer" class="form-select">
                                <option value="">Select</option>
                                <option value="Yes - Full Day">Yes - Full Day</option>
                                <option value="Yes - Partial Day">Yes - Partial Day</option>
                                <option value="No - Not Present">No - Not Present</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">PPE Compliance</label>
                            <select id="ppe-compliance" class="form-select">
                                <option value="">Select Compliance</option>
                                <option value="100% Compliant">100% Compliant</option>
                                <option value="95% Compliant">95% Compliant</option>
                                <option value="90% Compliant">90% Compliant</option>
                                <option value="Below 90%">Below 90%</option>
                                <option value="Poor Compliance">Poor Compliance</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Incident Type</label>
                        <select id="incident-type" class="form-select">
                            <option value="">Select Type</option>
                            <option value="No Incidents">‚úÖ No Incidents</option>
                            <option value="Near Miss">‚ö†Ô∏è Near Miss</option>
                            <option value="Minor Injury">ü©π Minor Injury</option>
                            <option value="First Aid Case">üè• First Aid Case</option>
                            <option value="Medical Treatment">üöë Medical Treatment</option>
                            <option value="Property Damage">üí• Property Damage</option>
                            <option value="Safety Violation">üö´ Safety Violation</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Safety Observations & Actions</label>
                        <textarea id="safety-observations" placeholder="Describe any safety incidents, observations, or corrective actions..." rows="4" class="form-textarea"></textarea>
                    </div>
                </div>

                <!-- Material Deliveries -->
                <div class="card">
                    <h3>üì¶ Material Deliveries & Usage</h3>
                    <div class="form-group">
                        <label class="form-label">Delivery Status</label>
                        <select id="delivery-status" class="form-select">
                            <option value="">Select Status</option>
                            <option value="No Deliveries">No Deliveries Today</option>
                            <option value="On Schedule">All Deliveries On Schedule</option>
                            <option value="Partial Deliveries">Partial Deliveries</option>
                            <option value="Delayed Deliveries">Delayed Deliveries</option>
                            <option value="Rejected Materials">Rejected Materials</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Material Types Delivered</label>
                        <select id="material-types" class="form-select">
                            <option value="">Select Materials</option>
                            <option value="Concrete">Concrete</option>
                            <option value="Steel/Rebar">Steel/Rebar</option>
                            <option value="Bricks/Blocks">Bricks/Blocks</option>
                            <option value="Electrical Materials">Electrical Materials</option>
                            <option value="Plumbing Materials">Plumbing Materials</option>
                            <option value="HVAC Equipment">HVAC Equipment</option>
                            <option value="Windows/Doors">Windows/Doors</option>
                            <option value="Multiple Types">Multiple Types</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Material Details & Issues</label>
                        <textarea id="material-details" placeholder="Details about deliveries, quantities, quality issues..." rows="3" class="form-textarea"></textarea>
                    </div>
                </div>
            </div>

            <!-- Summary Tab -->
            <div id="summary-content" class="tab-content">
                <!-- Daily Summary Stats -->
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-number" id="total-activities">0</div>
                        <div class="summary-label">Activities</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-number" id="total-workers">0</div>
                        <div class="summary-label">Total Workers</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-number" id="active-contractors">0</div>
                        <div class="summary-label">Contractors</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-number" id="work-hours">0</div>
                        <div class="summary-label">Work Hours</div>
                    </div>
                </div>

                <!-- Progress Overview -->
                <div class="card">
                    <h3>üìà Daily Progress Overview</h3>
                    <div class="form-group">
                        <label class="form-label">Overall Progress Rating</label>
                        <select id="progress-rating" class="form-select">
                            <option value="">Rate Today's Progress</option>
                            <option value="Excellent">üü¢ Excellent - Ahead of Schedule</option>
                            <option value="Good">üü° Good - On Schedule</option>
                            <option value="Fair">üü† Fair - Minor Delays</option>
                            <option value="Poor">üî¥ Poor - Behind Schedule</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Key Achievements Today</label>
                        <textarea id="key-achievements" placeholder="List major milestones, completions, or achievements..." rows="3" class="form-textarea"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Issues & Challenges</label>
                        <textarea id="issues-challenges" placeholder="Describe any problems, delays, or challenges..." rows="3" class="form-textarea"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tomorrow's Plan</label>
                        <textarea id="tomorrow-plan" placeholder="Outline planned activities for tomorrow..." rows="3" class="form-textarea"></textarea>
                    </div>
                </div>

                <!-- Report Generation -->
                <div class="card">
                    <h3>üìã Generate Daily Report</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                        <button onclick="previewReport()" class="btn btn-primary">üëÅÔ∏è Preview</button>
                        <button onclick="downloadReport()" class="btn btn-success" id="download-report-btn" disabled>‚¨áÔ∏è Download</button>
                        <button onclick="emailReport()" class="btn btn-warning" id="email-report-btn" disabled>üìß Email</button>
                    </div>
                    <p id="report-status-msg" class="text-center" style="color: #6b7280; margin-top: 12px; font-size: 14px;">Add activities to generate report</p>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-content" class="tab-content">
                <!-- Email Settings -->
                <div class="card">
                    <h3>üìß Email Configuration</h3>
                    <div class="form-group">
                        <label class="form-label">Primary Recipient</label>
                        <input type="email" id="primary-email" placeholder="manager@company.com" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CC Recipients (comma separated)</label>
                        <input type="text" id="cc-emails" placeholder="supervisor@company.com, client@company.com" class="form-input">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Your Name</label>
                            <input type="text" id="sender-name" placeholder="John Smith" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Your Email</label>
                            <input type="email" id="sender-email" placeholder="john.smith@company.com" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Company Settings -->
                <div class="card">
                    <h3>üè¢ Company Information</h3>
                    <div class="form-group">
                        <label class="form-label">Company Name</label>
                        <input type="text" id="company-name" placeholder="ABC Construction Ltd." class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Site Address</label>
                        <textarea id="site-address" placeholder="123 Construction Ave, Building Site, City" rows="2" class="form-textarea"></textarea>
                    </div>
                </div>

                <button onclick="saveSettings()" class="btn btn-success">üíæ Save Settings</button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="btn-group">
                <button onclick="saveDraft()" class="btn" style="background: #6b7280; color: white;">üíæ Save Progress</button>
                <button onclick="finalizeReport()" class="btn btn-primary" id="finalize-btn" disabled>üìß Send Daily Report</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let dailyActivities = [];
        let photos = {1: null, 2: null};
        let settings = {};
        let lastSaved = null;

        // Work type mappings for dropdowns
        const workTypeMap = {
            'Structural': [
                'Concrete Pouring', 'Reinforcement Installation', 'Formwork Setup', 'Formwork Removal',
                'Steel Erection', 'Beam Installation', 'Column Installation', 'Slab Casting',
                'Foundation Work', 'Structural Repairs'
            ],
            'Mechanical': [
                'Pipe Installation', 'Valve Installation', 'Pump Installation', 'Equipment Mounting',
                'Mechanical Testing', 'Pressure Testing', 'System Commissioning', 'Maintenance Work'
            ],
            'Electrical': [
                'Cable Installation', 'Conduit Installation', 'Panel Installation', 'Lighting Installation',
                'Socket Installation', 'Switch Installation', 'Testing & Commissioning', 'Fault Repairs'
            ],
            'Plumbing': [
                'Water Pipe Installation', 'Drainage Installation', 'Fixture Installation', 'Leak Repairs',
                'Pressure Testing', 'System Flushing', 'Backflow Testing'
            ],
            'HVAC': [
                'Ductwork Installation', 'AC Unit Installation', 'Ventilation Setup', 'Insulation Work',
                'System Testing', 'Air Balancing', 'Filter Installation'
            ],
            'Fire Safety': [
                'Sprinkler Installation', 'Fire Alarm Setup', 'Smoke Detector Installation', 'Fire Extinguisher Setup',
                'Emergency Lighting', 'Exit Sign Installation', 'System Testing'
            ],
            'Finishes': [
                'Painting', 'Tiling', 'Flooring Installation', 'Ceiling Work', 'Wall Finishes',
                'Door Installation', 'Window Installation', 'Trim Work'
            ],
            'Landscaping': [
                'Excavation', 'Planting', 'Irrigation Setup', 'Paving', 'Drainage Work', 'Site Cleanup'
            ],
            'Testing': [
                'Quality Inspections', 'Safety Testing', 'Performance Testing', 'Commissioning',
                'Documentation', 'Final Inspections'
            ],
            'Maintenance': [
                'Routine Maintenance', 'Repair Work', 'Equipment Service', 'Cleaning', 'Part Replacement'
            ]
        };

        // Initialize app
        function init() {
            console.log('Daily Site Report System starting...');
            
            try {
                // Set current date and time
                const now = new Date();
                const timeString = now.toTimeString().slice(0, 5);
                
                // Set default times
                document.getElementById('activity-start-time').value = timeString;
                
                // Start time updates
                updateDateTime();
                setInterval(updateDateTime, 1000);
                
                // Load saved data
                loadSettings();
                loadDailyData();
                
                console.log('Daily Site Report System initialized successfully');
            } catch (error) {
                console.error('Init error:', error);
                showMessage('‚ö†Ô∏è App initialization failed. Please refresh the page.', 'error');
            }
        }

        // Update date and time
        function updateDateTime() {
            try {
                const now = new Date();
                const dateEl = document.getElementById('current-date');
                const timeEl = document.getElementById('current-time');
                
                if (dateEl) dateEl.textContent = now.toLocaleDateString();
                if (timeEl) timeEl.textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } catch (error) {
                console.warn('DateTime update failed:', error);
            }
        }

        // Tab navigation
        function showTab(tabName, element) {
            try {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Show selected tab content
                const targetContent = document.getElementById(tabName + '-content');
                if (targetContent) {
                    targetContent.classList.add('active');
                }
                
                // Add active class to clicked tab
                if (element) {
                    element.classList.add('active');
                }
            } catch (error) {
                console.error('Tab switching error:', error);
            }
        }

        // Update work types based on category
        function updateWorkTypes() {
            try {
                const category = document.getElementById('work-category').value;
                const workTypeSelect = document.getElementById('work-type');
                
                // Clear current options
                workTypeSelect.innerHTML = '<option value="">Select Work Type</option>';
                
                if (category && workTypeMap[category]) {
                    workTypeMap[category].forEach(type => {
                        const option = document.createElement('option');
                        option.value = type;
                        option.textContent = type;
                        workTypeSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Update work types error:', error);
            }
        }

        // Photo functions
        function capturePhoto(photoNum) {
            try {
                const cameraInput = document.getElementById(`photo${photoNum}-camera`);
                if (cameraInput) {
                    cameraInput.click();
                }
            } catch (error) {
                console.error('Camera capture error:', error);
                showMessage('‚ùå Camera access failed. Try using gallery instead.', 'error');
            }
        }

        function selectPhoto(photoNum) {
            try {
                const galleryInput = document.getElementById(`photo${photoNum}-gallery`);
                if (galleryInput) {
                    galleryInput.click();
                }
            } catch (error) {
                console.error('Gallery selection error:', error);
            }
        }

        function handlePhoto(photoNum, input) {
            try {
                const file = input.files[0];
                if (!file) return;
                
                // Check file size (limit to 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showMessage('‚ùå Photo too large. Please select a smaller image (max 5MB).', 'error');
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    showMessage('‚ùå Please select a valid image file.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        photos[photoNum] = {
                            data: e.target.result,
                            name: file.name
                        };
                        
                        // Show preview
                        const imgEl = document.getElementById(`photo${photoNum}-img`);
                        const nameEl = document.getElementById(`photo${photoNum}-name`);
                        const previewEl = document.getElementById(`photo${photoNum}-preview`);
                        const inputEl = document.getElementById(`photo${photoNum}-input`);
                        
                        if (imgEl) imgEl.src = e.target.result;
                        if (nameEl) nameEl.textContent = file.name;
                        if (previewEl) previewEl.classList.remove('hidden');
                        if (inputEl) inputEl.classList.add('hidden');
                        
                        showMessage(`‚úÖ Photo ${photoNum} uploaded successfully!`, 'success');
                    } catch (error) {
                        console.error('Photo preview error:', error);
                        showMessage('‚ùå Photo preview failed.', 'error');
                    }
                };
                
                reader.onerror = function() {
                    showMessage('‚ùå Failed to read photo file.', 'error');
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                console.error('Photo handling error:', error);
                showMessage('‚ùå Photo upload failed.', 'error');
            }
        }

        function removePhoto(photoNum) {
            try {
                photos[photoNum] = null;
                
                const previewEl = document.getElementById(`photo${photoNum}-preview`);
                const inputEl = document.getElementById(`photo${photoNum}-input`);
                const cameraEl = document.getElementById(`photo${photoNum}-camera`);
                const galleryEl = document.getElementById(`photo${photoNum}-gallery`);
                
                if (previewEl) previewEl.classList.add('hidden');
                if (inputEl) inputEl.classList.remove('hidden');
                if (cameraEl) cameraEl.value = '';
                if (galleryEl) galleryEl.value = '';
                
                showMessage(`‚úÖ Photo ${photoNum} removed.`, 'success');
            } catch (error) {
                console.error('Photo removal error:', error);
            }
        }

        // Add activity function
        function addActivity() {
            try {
                const startTime = document.getElementById('activity-start-time').value;
                const location = document.getElementById('location').value;
                const contractor = document.getElementById('contractor').value;
                const workCategory = document.getElementById('work-category').value;
                
                if (!startTime || !location || !contractor || !workCategory) {
                    showMessage('‚ùå Please fill in Start Time, Location, Contractor, and Work Category', 'error');
                    return;
                }

                const activity = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleString(),
                    startTime: startTime,
                    endTime: document.getElementById('activity-end-time').value || '',
                    location: location,
                    specificArea: document.getElementById('specific-area').value || '',
                    locationDetails: document.getElementById('location-details').value || '',
                    contractor: contractor,
                    workCategory: workCategory,
                    workType: document.getElementById('work-type').value || '',
                    workDescription: document.getElementById('work-description').value || '',
                    workStatus: document.getElementById('work-status').value || '',
                    qualityStatus: document.getElementById('quality-status').value || '',
                    workerCount: document.getElementById('worker-count').value || '',
                    equipmentUsed: document.getElementById('equipment-used').value || '',
                    photos: JSON.parse(JSON.stringify(photos)) // Deep copy
                };

                dailyActivities.push(activity);
                clearActivityForm();
                updateActivityDisplay();
                updateSummaryStats();
                
                showMessage('‚úÖ Activity added successfully!', 'success');
                
                // Auto-switch to overview tab
                setTimeout(() => {
                    const overviewTab = document.querySelector('.tab:first-child');
                    if (overviewTab) {
                        showTab('overview', overviewTab);
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Add activity error:', error);
                showMessage('‚ùå Failed to add activity. Please try again.', 'error');
            }
        }

        // Clear activity form
        function clearActivityForm() {
            try {
                const formFields = [
                    'activity-end-time', 'location', 'specific-area', 'location-details',
                    'contractor', 'work-category', 'work-type', 'work-description',
                    'work-status', 'quality-status', 'worker-count', 'equipment-used'
                ];
                
                formFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.value = '';
                });
                
                // Clear photos
                for (let i = 1; i <= 2; i++) {
                    removePhoto(i);
                }
                
                // Reset work types dropdown
                document.getElementById('work-type').innerHTML = '<option value="">Select Work Type</option>';
                
                // Update start time to current time
                const now = new Date();
                const timeString = now.toTimeString().slice(0, 5);
                document.getElementById('activity-start-time').value = timeString;
                
            } catch (error) {
                console.error('Form clearing error:', error);
            }
        }

        // Update activity display
        function updateActivityDisplay() {
            try {
                const countEl = document.getElementById('activity-count');
                if (countEl) countEl.textContent = dailyActivities.length;
                
                const activitiesList = document.getElementById('activities-list');
                if (!activitiesList) return;
                
                if (dailyActivities.length === 0) {
                    activitiesList.innerHTML = `
                        <div class="text-center" style="padding: 40px; color: #6b7280;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                            <p>No activities recorded today.<br>Use the Activity tab to add work entries.</p>
                        </div>
                    `;
                } else {
                    activitiesList.innerHTML = dailyActivities.map((activity, index) => `
                        <div class="activity-entry">
                            <div class="activity-header">
                                <div>
                                    <div class="activity-time">${activity.startTime}${activity.endTime ? ' - ' + activity.endTime : ''}</div>
                                </div>
                                <button class="activity-delete" onclick="deleteActivity(${index})">üóëÔ∏è</button>
                            </div>
                            <div class="activity-details">
                                <div><strong>üìç Location:</strong> ${activity.location}${activity.specificArea ? ' - ' + activity.specificArea : ''}</div>
                                <div><strong>üë∑ Contractor:</strong> ${activity.contractor}</div>
                                <div><strong>üîß Work:</strong> ${activity.workCategory}${activity.workType ? ' - ' + activity.workType : ''}</div>
                                ${activity.workDescription ? `<div><strong>üìù Description:</strong> ${activity.workDescription}</div>` : ''}
                                ${activity.workerCount ? `<div><strong>üë• Workers:</strong> ${activity.workerCount}</div>` : ''}
                                ${activity.workStatus ? `<div><strong>üìä Status:</strong> ${activity.workStatus}</div>` : ''}
                                ${activity.equipmentUsed ? `<div><strong>üèóÔ∏è Equipment:</strong> ${activity.equipmentUsed}</div>` : ''}
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Activity display error:', error);
            }
        }

        // Delete activity
        function deleteActivity(index) {
            try {
                if (confirm('‚ùå Delete this activity?')) {
                    dailyActivities.splice(index, 1);
                    updateActivityDisplay();
                    updateSummaryStats();
                    showMessage('‚úÖ Activity deleted.', 'success');
                }
            } catch (error) {
                console.error('Delete activity error:', error);
            }
        }

        // Update summary statistics
        function updateSummaryStats() {
            try {
                const totalActivities = dailyActivities.length;
                const totalWorkers = dailyActivities.reduce((sum, activity) => {
                    const workers = parseInt(activity.workerCount) || 0;
                    return sum + workers;
                }, 0);
                const activeContractors = [...new Set(dailyActivities.map(a => a.contractor).filter(c => c))].length;
                
                // Calculate work hours (rough estimate)
                let totalHours = 0;
                dailyActivities.forEach(activity => {
                    if (activity.startTime && activity.endTime) {
                        const start = new Date(`2000-01-01T${activity.startTime}`);
                        const end = new Date(`2000-01-01T${activity.endTime}`);
                        const hours = (end - start) / (1000 * 60 * 60);
                        if (hours > 0) totalHours += hours;
                    }
                });
                
                // Update display
                document.getElementById('total-activities').textContent = totalActivities;
                document.getElementById('total-workers').textContent = totalWorkers;
                document.getElementById('active-contractors').textContent = activeContractors;
                document.getElementById('work-hours').textContent = Math.round(totalHours * 10) / 10;
                
                // Update buttons based on data
                const hasActivities = totalActivities > 0;
                document.getElementById('download-report-btn').disabled = !hasActivities;
                document.getElementById('email-report-btn').disabled = !hasActivities;
                document.getElementById('finalize-btn').disabled = !hasActivities;
                
                const statusMsg = document.getElementById('report-status-msg');
                if (statusMsg) {
                    statusMsg.textContent = hasActivities ? 'Report ready to generate' : 'Add activities to generate report';
                }
                
                // Update report status
                const reportStatus = document.getElementById('report-status');
                if (reportStatus) {
                    if (totalActivities === 0) {
                        reportStatus.textContent = 'üü° In Progress';
                    } else if (totalActivities < 3) {
                        reportStatus.textContent = 'üü† Partial';
                    } else {
                        reportStatus.textContent = 'üü¢ Ready';
                    }
                }
                
            } catch (error) {
                console.error('Summary stats update error:', error);
            }
        }

        // Show message
        function showMessage(message, type) {
            try {
                const messageDiv = document.getElementById('activity-message');
                if (messageDiv) {
                    let className = 'info-message';
                    if (type === 'success') className = 'success-message';
                    if (type === 'error') className = 'error-message';
                    
                    messageDiv.className = className;
                    messageDiv.textContent = message;
                    
                    setTimeout(() => {
                        messageDiv.textContent = '';
                        messageDiv.className = '';
                    }, 4000);
                }
            } catch (error) {
                console.error('Message display error:', error);
            }
        }

        // Preview report
        function previewReport() {
            try {
                if (dailyActivities.length === 0) {
                    showMessage('‚ùå No activities to preview. Please add activities first.', 'error');
                    return;
                }
                
                const reportHTML = generateReportHTML();
                
                // Open in new window for preview
                const previewWindow = window.open('', '_blank');
                previewWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Daily Site Report Preview</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                            .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
                            .summary { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; }
                            .activity { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 8px; }
                            .activity-header { font-weight: bold; color: #1e40af; margin-bottom: 10px; }
                            .btn { background: #1e40af; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
                        </style>
                    </head>
                    <body>
                        ${reportHTML}
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn" onclick="window.print()">üñ®Ô∏è Print Report</button>
                            <button class="btn" onclick="window.close()">‚ùå Close Preview</button>
                        </div>
                    </body>
                    </html>
                `);
                previewWindow.document.close();
                
            } catch (error) {
                console.error('Preview report error:', error);
                showMessage('‚ùå Failed to preview report.', 'error');
            }
        }

        // Generate report HTML
        function generateReportHTML() {
            try {
                const today = new Date().toLocaleDateString();
                const projectName = document.getElementById('project-name').value || 'Construction Project';
                const siteSupervisor = document.getElementById('site-supervisor').value || 'Not specified';
                const workShift = document.getElementById('work-shift').value || 'Not specified';
                const weatherCondition = document.getElementById('weather-condition').value || 'Not reported';
                const safetyStatus = document.getElementById('safety-status').value || 'Not reported';
                
                const totalWorkers = dailyActivities.reduce((sum, activity) => {
                    const workers = parseInt(activity.workerCount) || 0;
                    return sum + workers;
                }, 0);
                
                const contractors = [...new Set(dailyActivities.map(a => a.contractor).filter(c => c))];
                
                let reportHTML = `
                    <div class="header">
                        <h1>üìä DAILY SITE REPORT</h1>
                        <h2>${projectName}</h2>
                        <p><strong>Date:</strong> ${today} | <strong>Supervisor:</strong> ${siteSupervisor}</p>
                        <p><strong>Shift:</strong> ${workShift} | <strong>Weather:</strong> ${weatherCondition}</p>
                    </div>
                    
                    <div class="summary">
                        <h3>üìà Daily Summary</h3>
                        <p><strong>Total Activities:</strong> ${dailyActivities.length}</p>
                        <p><strong>Total Workers:</strong> ${totalWorkers}</p>
                        <p><strong>Active Contractors:</strong> ${contractors.length}</p>
                        <p><strong>Safety Status:</strong> ${safetyStatus}</p>
                    </div>
                    
                    <h3>üìù Daily Activities</h3>
                `;
                
                dailyActivities.forEach((activity, index) => {
                    reportHTML += `
                        <div class="activity">
                            <div class="activity-header">
                                Activity #${index + 1} - ${activity.startTime}${activity.endTime ? ' to ' + activity.endTime : ''}
                            </div>
                            <p><strong>Location:</strong> ${activity.location}${activity.specificArea ? ' - ' + activity.specificArea : ''}</p>
                            <p><strong>Contractor:</strong> ${activity.contractor}</p>
                            <p><strong>Work Type:</strong> ${activity.workCategory}${activity.workType ? ' - ' + activity.workType : ''}</p>
                            ${activity.workDescription ? `<p><strong>Description:</strong> ${activity.workDescription}</p>` : ''}
                            ${activity.workerCount ? `<p><strong>Manpower:</strong> ${activity.workerCount} workers</p>` : ''}
                            ${activity.workStatus ? `<p><strong>Status:</strong> ${activity.workStatus}</p>` : ''}
                            ${activity.equipmentUsed ? `<p><strong>Equipment:</strong> ${activity.equipmentUsed}</p>` : ''}
                        </div>
                    `;
                });
                
                // Add additional sections if filled
                const keyAchievements = document.getElementById('key-achievements').value;
                const issuesChallenges = document.getElementById('issues-challenges').value;
                const tomorrowPlan = document.getElementById('tomorrow-plan').value;
                const safetyObservations = document.getElementById('safety-observations').value;
                const materialDetails = document.getElementById('material-details').value;
                
                if (keyAchievements || issuesChallenges || tomorrowPlan) {
                    reportHTML += `
                        <div style="margin-top: 30px;">
                            <h3>üìã Additional Information</h3>
                    `;
                    
                    if (keyAchievements) {
                        reportHTML += `<div style="margin: 15px 0;"><strong>Key Achievements:</strong><br>${keyAchievements}</div>`;
                    }
                    
                    if (issuesChallenges) {
                        reportHTML += `<div style="margin: 15px 0;"><strong>Issues & Challenges:</strong><br>${issuesChallenges}</div>`;
                    }
                    
                    if (tomorrowPlan) {
                        reportHTML += `<div style="margin: 15px 0;"><strong>Tomorrow's Plan:</strong><br>${tomorrowPlan}</div>`;
                    }
                    
                    reportHTML += `</div>`;
                }
                
                if (safetyObservations) {
                    reportHTML += `
                        <div style="margin-top: 20px; background: #fef3cd; padding: 15px; border-radius: 8px;">
                            <h3>üõ°Ô∏è Safety Observations</h3>
                            <p>${safetyObservations}</p>
                        </div>
                    `;
                }
                
                if (materialDetails) {
                    reportHTML += `
                        <div style="margin-top: 20px; background: #eff6ff; padding: 15px; border-radius: 8px;">
                            <h3>üì¶ Material Information</h3>
                            <p>${materialDetails}</p>
                        </div>
                    `;
                }
                
                reportHTML += `
                    <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #666;">
                        <p>Report generated on ${new Date().toLocaleString()}</p>
                        <p>Daily Site Report System</p>
                    </div>
                `;
                
                return reportHTML;
            } catch (error) {
                console.error('Generate report HTML error:', error);
                return '<p>Error generating report preview.</p>';
            }
        }

        // Download report
        function downloadReport() {
            try {
                if (dailyActivities.length === 0) {
                    showMessage('‚ùå No activities to export.', 'error');
                    return;
                }
                
                const reportHTML = generateFullReportHTML();
                const blob = new Blob([reportHTML], { type: 'text/html;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                const today = new Date().toISOString().split('T')[0];
                const projectName = document.getElementById('project-name').value || 'Project';
                const fileName = `Daily_Site_Report_${projectName.replace(/\s+/g, '_')}_${today}.html`;
                
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setTimeout(() => URL.revokeObjectURL(url), 1000);
                
                showMessage('‚úÖ Daily report downloaded successfully!', 'success');
            } catch (error) {
                console.error('Download report error:', error);
                showMessage('‚ùå Report download failed.', 'error');
            }
        }

        // Generate full report HTML with styling
        function generateFullReportHTML() {
            const reportContent = generateReportHTML();
            return `<!DOCTYPE html>
<html>
<head>
    <title>Daily Site Report - ${new Date().toLocaleDateString()}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 30px; }
        .summary { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .activity { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 8px; }
        .activity-header { font-weight: bold; color: #1e40af; margin-bottom: 10px; }
        @media print { body { margin: 0; } }
    </style>
</head>
<body>
    ${reportContent}
</body>
</html>`;
        }

        // Email report
        function emailReport() {
            try {
                if (dailyActivities.length === 0) {
                    showMessage('‚ùå No activities to email.', 'error');
                    return;
                }
                
                const today = new Date().toLocaleDateString();
                const projectName = document.getElementById('project-name').value || 'Construction Project';
                const primaryEmail = document.getElementById('primary-email').value;
                
                if (!primaryEmail) {
                    showMessage('‚öôÔ∏è Please configure email settings first in the Settings tab.', 'error');
                    return;
                }
                
                const subject = `Daily Site Report - ${projectName} - ${today}`;
                const body = `Please find attached the daily site report for ${projectName}.

Report Summary:
‚Ä¢ Date: ${today}
‚Ä¢ Total Activities: ${dailyActivities.length}
‚Ä¢ Active Contractors: ${[...new Set(dailyActivities.map(a => a.contractor).filter(c => c))].length}
‚Ä¢ Generated: ${new Date().toLocaleString()}

Best regards,
${document.getElementById('sender-name').value || 'Site Supervisor'}`;
                
                // Create mailto link
                let mailtoLink = `mailto:${primaryEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                const ccEmails = document.getElementById('cc-emails').value;
                if (ccEmails) {
                    mailtoLink += `&cc=${encodeURIComponent(ccEmails)}`;
                }
                
                // Download report first, then open email
                downloadReport();
                
                setTimeout(() => {
                    window.location.href = mailtoLink;
                    showMessage('‚úÖ Email client opened! Please attach the downloaded report.', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Email report error:', error);
                showMessage('‚ùå Email sending failed.', 'error');
            }
        }

        // Finalize and send daily report
        function finalizeReport() {
            try {
                if (dailyActivities.length === 0) {
                    showMessage('‚ùå Cannot send empty report. Please add activities first.', 'error');
                    return;
                }
                
                const projectName = document.getElementById('project-name').value || 'Construction Project';
                const today = new Date().toLocaleDateString();
                
                if (confirm(`üìß Send Daily Site Report?\n\n‚Ä¢ Project: ${projectName}\n‚Ä¢ Date: ${today}\n‚Ä¢ Activities: ${dailyActivities.length}\n\nThis will finalize today's report and email it.`)) {
                    
                    // Send email
                    emailReport();
                    
                    // Ask if they want to start fresh for tomorrow
                    setTimeout(() => {
                        if (confirm('‚úÖ Report sent successfully!\n\nüÜï Clear data for tomorrow?\n\nThis will reset all activities for a new day.')) {
                            clearDailyData();
                        }
                    }, 2000);
                }
            } catch (error) {
                console.error('Finalize report error:', error);
                showMessage('‚ùå Finalize failed.', 'error');
            }
        }

        // Save settings
        function saveSettings() {
            try {
                settings = {
                    primaryEmail: document.getElementById('primary-email').value,
                    ccEmails: document.getElementById('cc-emails').value,
                    senderName: document.getElementById('sender-name').value,
                    senderEmail: document.getElementById('sender-email').value,
                    companyName: document.getElementById('company-name').value,
                    siteAddress: document.getElementById('site-address').value
                };
                
                showMessage('‚úÖ Settings saved successfully!', 'success');
                
            } catch (error) {
                console.error('Save settings error:', error);
                showMessage('‚ùå Failed to save settings.', 'error');
            }
        }

        // Load settings
        function loadSettings() {
            try {
                // Load from memory if available
                if (settings.primaryEmail) {
                    document.getElementById('primary-email').value = settings.primaryEmail;
                }
                if (settings.ccEmails) {
                    document.getElementById('cc-emails').value = settings.ccEmails;
                }
                if (settings.senderName) {
                    document.getElementById('sender-name').value = settings.senderName;
                }
                if (settings.senderEmail) {
                    document.getElementById('sender-email').value = settings.senderEmail;
                }
                if (settings.companyName) {
                    document.getElementById('company-name').value = settings.companyName;
                }
                if (settings.siteAddress) {
                    document.getElementById('site-address').value = settings.siteAddress;
                }
            } catch (error) {
                console.warn('Load settings failed:', error);
            }
        }

        // Save draft
        function saveDraft() {
            try {
                const draftData = {
                    date: new Date().toISOString().split('T')[0],
                    dailyActivities: dailyActivities,
                    currentForm: {
                        projectName: document.getElementById('project-name').value,
                        siteSupervisor: document.getElementById('site-supervisor').value,
                        workShift: document.getElementById('work-shift').value,
                        weatherCondition: document.getElementById('weather-condition').value,
                        temperature: document.getElementById('temperature').value,
                        siteConditions: document.getElementById('site-conditions').value,
                        safetyStatus: document.getElementById('safety-status').value,
                        safetyOfficer: document.getElementById('safety-officer').value,
                        ppeCompliance: document.getElementById('ppe-compliance').value,
                        incidentType: document.getElementById('incident-type').value,
                        safetyObservations: document.getElementById('safety-observations').value,
                        deliveryStatus: document.getElementById('delivery-status').value,
                        materialTypes: document.getElementById('material-types').value,
                        materialDetails: document.getElementById('material-details').value,
                        progressRating: document.getElementById('progress-rating').value,
                        keyAchievements: document.getElementById('key-achievements').value,
                        issuesChallenges: document.getElementById('issues-challenges').value,
                        tomorrowPlan: document.getElementById('tomorrow-plan').value
                    },
                    photos: photos,
                    settings: settings,
                    savedAt: new Date().toLocaleString()
                };
                
                // Store in session memory
                window.dailySiteReportData = draftData;
                lastSaved = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                document.getElementById('last-saved').textContent = lastSaved;
                
                showMessage('‚úÖ Progress saved successfully!', 'success');
            } catch (error) {
                console.error('Save draft error:', error);
                showMessage('‚ùå Save failed.', 'error');
            }
        }

        // Load daily data
        function loadDailyData() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const data = window.dailySiteReportData;
                
                if (data && data.date === today) {
                    // Load activities
                    if (data.dailyActivities) {
                        dailyActivities = data.dailyActivities;
                        updateActivityDisplay();
                        updateSummaryStats();
                    }
                    
                    // Load form data
                    if (data.currentForm) {
                        const form = data.currentForm;
                        Object.keys(form).forEach(key => {
                            const element = document.getElementById(key.replace(/([A-Z])/g, '-$1').toLowerCase());
                            if (element && form[key]) {
                                element.value = form[key];
                            }
                        });
                    }
                    
                    // Load photos
                    if (data.photos) {
                        photos = data.photos;
                        for (let i = 1; i <= 2; i++) {
                            if (photos[i]) {
                                try {
                                    const imgEl = document.getElementById(`photo${i}-img`);
                                    const nameEl = document.getElementById(`photo${i}-name`);
                                    const previewEl = document.getElementById(`photo${i}-preview`);
                                    const inputEl = document.getElementById(`photo${i}-input`);
                                    
                                    if (imgEl) imgEl.src = photos[i].data;
                                    if (nameEl) nameEl.textContent = photos[i].name;
                                    if (previewEl) previewEl.classList.remove('hidden');
                                    if (inputEl) inputEl.classList.add('hidden');
                                } catch (e) {
                                    console.warn(`Could not load photo ${i}:`, e);
                                }
                            }
                        }
                    }
                    
                    // Load settings
                    if (data.settings) {
                        settings = data.settings;
                        loadSettings();
                    }
                    
                    lastSaved = data.savedAt ? new Date(data.savedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'Unknown';
                    document.getElementById('last-saved').textContent = lastSaved;
                    
                    showMessage('‚úÖ Previous session data loaded!', 'success');
                }
            } catch (error) {
                console.warn('Load daily data failed:', error);
            }
        }

        // Clear daily data
        function clearDailyData() {
            try {
                dailyActivities = [];
                photos = {1: null, 2: null};
                
                // Clear form fields except settings
                const allInputs = document.querySelectorAll('input, select, textarea');
                allInputs.forEach(input => {
                    // Don't clear settings fields
                    if (!input.id.includes('email') && !input.id.includes('sender') && !input.id.includes('company') && !input.id.includes('site-address')) {
                        if (input.type !== 'checkbox') {
                            input.value = '';
                        }
                    }
                });
                
                // Clear photo previews
                for (let i = 1; i <= 2; i++) {
                    removePhoto(i);
                }
                
                // Reset displays
                updateActivityDisplay();
                updateSummaryStats();
                
                // Clear saved data but keep settings
                window.dailySiteReportData = null;
                document.getElementById('last-saved').textContent = 'Not saved';
                
                // Reset time
                const now = new Date();
                const timeString = now.toTimeString().slice(0, 5);
                document.getElementById('activity-start-time').value = timeString;
                
                showMessage('‚úÖ Daily data cleared for new day!', 'success');
            } catch (error) {
                console.error('Clear daily data error:', error);
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Daily Site Report System DOM loaded, initializing...');
            init();
            
            // Check for saved data
            setTimeout(() => {
                try {
                    const today = new Date().toISOString().split('T')[0];
                    const savedData = window.dailySiteReportData;
                    
                    if (savedData && savedData.date === today && savedData.dailyActivities?.length > 0) {
                        if (confirm('üìÑ Found saved data from today. Continue working on it?')) {
                            // Data already loaded in loadDailyData()
                        } else {
                            clearDailyData();
                        }
                    }
                } catch (error) {
                    console.warn('Startup data check failed:', error);
                }
            }, 1000);
        });

        console.log('Daily Site Report System script loaded successfully');
    </script>
</body>
</html>
